---
attack_technique: T1096
display_name: NTFS File Attributes

atomic_tests:
- name: Alternate Data Streams (ADS)
  description: |
    Execute from Alternate Streams

    [Reference - 1](https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f)

    [Reference - 2](https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/)

  supported_platforms:
    - windows

  input_arguments:
    path:
      description: Path of ADS file
      type: path
      default: c:\ADS\

  executor:
    name: command_prompt
    elevation_required: true
    command: |
      echo Normal text > normal.txt
      echo Hidden text > normal.txt:hidden.txt
      del normal.txt

- name: Store file in Alternate Data Stream (ADS)
  description: |
    Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.

  supported_platforms:
    - windows

  input_arguments:
    payload_path:
      description: Path of file to hide in ADS
      type: path
      default: c:\windows\system32\cmd.exe
    ads_file_path:
      description: Path of file to create an ADS under
      type: path
      default: desktop.ini
    ads_name:
      description: Name of ADS
      type: string
      default: ADSName

  executor:
    name: powershell
    elevation_required: false
    prereq_command: |
      if (!(Test-Path "#{ads_file_path}"))
      {
        $FileCreated = New-Item -Path "#{ads_file_path}" -Type "file" -Force
        0
      }
      else {0}
    command: |
      Start-Process -FilePath "$env:comspec" -ArgumentList "/c,type,#{payload_path},>,`"#{ads_file_path}:#{ads_name}`""
      Remove-Item -Path "#{ads_file_path}"